## 虚拟存储器的概念
- 虚拟存储器和主存的关系类似于主存和Cache之间的关系,将主存作为外存的高速缓存,从而提升访问性能
> Cache和主存之间以 __块__ 为单位进行数据调度,主存和页之间以 __页__ 为单位进行数据调度

- 用户编程允许的地址称为 __虚地址或者逻辑地址__,虚地址对应的存储空间称为 __虚拟空间或程序空间__,实际的主存单元地址称为 __实地址或者物理地址__,实地址对应的是 __主存地址空间__,虚地址比实地址大

## 页式虚拟存储器
- 页式虚拟存储器以页为基本单位,主存空间和虚拟空间被划分成相同大小的页,主存空间中的页称为 __物理页(实页,页框)__, 虚拟地址空间的页称为 __虚拟页(虚页)__
### 页表
__页表记录虚拟地址被调入主存后在主存中的位置__
![主存储器中的页表示例图](https://img.picui.cn/free/2024/09/19/66ec198b76a75.jpg)
- 有效位(Valid)
> 用于记录该磁盘地址是否存在于主存中,若有效位位1,则处于主存中,反之则不在磁盘中
- 脏位(一致性位)
> 用于记录主存地址所指向的内容是否发生过修改
### 分页存放,缺页异常分析及缺页处理过程
- 假设CPU想要访问的数据在第一页,且Valid = 1说明该页在主存中,通过地址转换部件,将虚拟地址转化成物理地址,然后再主存中读取这个数据
- 若数据在第5页,Valid = 0,发生缺页现象,需要操作系统调用缺页异常处理,若内存中没有空闲页框,还需要选择一个页面替换
- 若数据在第11页,Valid = 1说明在内存中,但是脏位为1,说明数据发生过修改,则需要将当前数据写回磁盘中,以保存对数据的修改,而后将脏位改为0,最后操作系统安全的替换该页,将其从页表中移除并且替换上新页
### 地址转换
![页式虚拟存储器地址变换过程](https://img.picui.cn/free/2024/09/19/66ec1f3ea5b96.jpg)
### 快表
- 依据程序的局部性原理,某些页总是会频繁的被访问,可以将这些页存放在由 __高速缓冲存储器__ 组成的 __快表(TLB)__ 中
- 快表采用SRAM组成,工作原理类似于Cache,通常是组相联或者是全相联的映射方式
![TLB和Cache的访问过程](https://img.picui.cn/free/2024/09/19/66ec21592aa6a.jpg)

- TLB例题:
![例题](https://img.picui.cn/free/2024/09/19/66ec22660d0bf.jpg)
> 虚拟地址空间大小为4GB且按字节编址,可以得到共有4G这么多的空间,而虚拟地址以页为单位,且一页由4KB,则共有2^20这么多页,需要20位进行编址,则03FF F180H中后20为为业内地址,查快表可得,有效位为1,说明存在于主存中,在主存中的页框(物理页号)为0153H,则虚实转换后的结果为 __015 3180H__
>
> 物理地址 = 物理页号 + 页内地址
> 虚拟地址 = 虚拟页号 + 页内地址
